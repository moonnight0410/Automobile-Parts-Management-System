# Fabric 网络环境变量配置

本文档记录了Fabric网络中各组织的环境变量配置，用于链码部署和操作。

## 通用环境变量

所有组织都需要设置的基础环境变量：

```bash
export PATH=~/fabric/fabric-samples/bin:$PATH
export FABRIC_CFG_PATH=~/fabric/fabric-samples/config
export CORE_PEER_TLS_ENABLED=true
```

## Org1 环境变量

**组织信息：**
- 组织名称：`org1.example.com`
- MSPID：`Org1MSP`
- Peer端口：`7051`

**环境变量配置：**

```bash
export CORE_PEER_LOCALMSPID="Org1MSP"
export CORE_PEER_MSPCONFIGPATH=~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
export CORE_PEER_ADDRESS=localhost:7051
export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
```
```bash
export PATH=~/fabric/fabric-samples/bin:$PATH
export FABRIC_CFG_PATH=~/fabric/fabric-samples/config
export CORE_PEER_LOCALMSPID="Org1MSP"
export CORE_PEER_MSPCONFIGPATH=~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
export CORE_PEER_ADDRESS=localhost:7051
export CORE_PEER_TLS_ENABLED=true
export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
```
**TLS证书路径：**
- Admin MSP：`~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp`
- Peer TLS证书：`${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt`

---

## Org2 环境变量

**组织信息：**
- 组织名称：`org2.example.com`
- MSPID：`Org2MSP`
- Peer端口：`9051`

**环境变量配置：**

```bash
export PATH=~/fabric/fabric-samples/bin:$PATH
export FABRIC_CFG_PATH=~/fabric/fabric-samples/config
export CORE_PEER_TLS_ENABLED=true
export CORE_PEER_LOCALMSPID="Org2MSP"
export CORE_PEER_MSPCONFIGPATH=~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
export CORE_PEER_ADDRESS=localhost:9051
export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
```

**TLS证书路径：**
- Admin MSP：`~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp`
- Peer TLS证书：`${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt`

---

## Org3 环境变量

**组织信息：**
- 组织名称：`org3.example.com`
- MSPID：`Org3MSP`
- Peer端口：`11051`

**环境变量配置：**

```bash
export CORE_PEER_LOCALMSPID="Org3MSP"
export CORE_PEER_MSPCONFIGPATH=~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp
export CORE_PEER_ADDRESS=localhost:11051
export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt
```
```bash
export PATH=~/fabric/fabric-samples/bin:$PATH
export FABRIC_CFG_PATH=~/fabric/fabric-samples/config
export CORE_PEER_TLS_ENABLED=true
export CORE_PEER_LOCALMSPID="Org3MSP"
export CORE_PEER_MSPCONFIGPATH=~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp
export CORE_PEER_ADDRESS=localhost:11051
export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt
```
**TLS证书路径：**
- Admin MSP：`~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp`
- Peer TLS证书：`${PWD}/organizations/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt`

---

## Orderer 环境变量

**Orderer信息：**
- Orderer名称：`orderer.example.com`
- Orderer端口：`7050`
- TLS主机名覆盖：`orderer.example.com`

**TLS证书路径：**
```bash
--cafile ${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
```

---

## 通道配置

**当前通道信息：**
- 通道名称：`channel1`
- 已加入组织：Org1、Org2、Org3

**链码信息：**
- 链码名称：`auto-system`
- 初始版本：`1.0`

---

## 使用示例

### 切换到Org1环境

```bash
export CORE_PEER_LOCALMSPID="Org1MSP"
export CORE_PEER_MSPCONFIGPATH=~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
export CORE_PEER_ADDRESS=localhost:7051
export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
```

### 切换到Org2环境

```bash
export CORE_PEER_LOCALMSPID="Org2MSP"
export CORE_PEER_MSPCONFIGPATH=~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
export CORE_PEER_ADDRESS=localhost:9051
export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
```

### 切换到Org3环境

```bash
export CORE_PEER_LOCALMSPID="Org3MSP"
export CORE_PEER_MSPCONFIGPATH=~/fabric/fabric-samples/test-network/organizations/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp
export CORE_PEER_ADDRESS=localhost:11051
export CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt
```

---

## 快速参考表

| 组织 | MSPID | Peer端口 | 组织名称 |
|------|-------|----------|----------|
| Org1 | Org1MSP | 7051 | org1.example.com |
| Org2 | Org2MSP | 9051 | org2.example.com |
| Org3 | Org3MSP | 11051 | org3.example.com |

---

## 注意事项

1. **工作目录**：在设置环境变量之前，请确保已经进入Fabric网络目录：
   ```bash
   cd ~/fabric/fabric-samples/test-network
   ```

2. **TLS证书**：`${PWD}`变量指向当前工作目录，请确保在正确的目录下执行命令。

3. **环境变量持久化**：如果需要持久化环境变量，可以将它们添加到`~/.bashrc`或`~/.bash_profile`文件中。

4. **验证环境变量**：可以使用以下命令验证环境变量是否设置正确：
   ```bash
   echo $CORE_PEER_LOCALMSPID
   echo $CORE_PEER_ADDRESS
   ```

5. **切换组织**：在执行不同组织的操作时，记得切换到对应组织的环境变量。

---

## 相关文档

- [部署链码流程.md](./部署链码流程.md)
- [MSP规划.md](./MSP规划.md)
- [Fabric链码更新流程.md](./Fabric链码更新流程.md)
